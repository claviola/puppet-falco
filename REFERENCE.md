# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Classes

* [`falco`](#falco): Guides the basic setup and installation of Falco on your system.
* [`falco::config`](#falcoconfig): Controls the contents of falco.yaml and sets up log rotate, if needed
* [`falco::install`](#falcoinstall): Installs the falco package
* [`falco::repo`](#falcorepo): Manages the repository falco is installed from
* [`falco::service`](#falcoservice): Controls the state of the falco service

## Classes

### <a name="falco"></a>`falco`

When this class is declared with the default options, Puppet:

* Installs the appropriate Falco software package and installs the falco-probe kernel module for your operating system.
* Creates the required configuration file `/etc/Falco/falco.yaml`. By default only syslog output is enabled.
* Starts the falco service.

#### Examples

##### Using defaults

```puppet
include falco
```

##### Enabling file output

```puppet
class { 'falco':
  file_output => {
    'enabled'    => 'true',
    'keep_alive' => 'false',
    'filename'   => '/var/log/falco-events.log',
  },
}
```

##### Enabling program output

```puppet
class { 'falco':
  json_output => 'true',
  program_output => {
    'enabled'    => 'true',
    'keep_alive' => 'false',
    'program'    => 'curl http://some-webhook.com'
  },
}
```

##### Create local rule

```puppet
class { 'falco':
  local_rules => [{
    'rule'      => 'The program "sudo" is run in a container',
    'desc'      => 'An event will trigger every time you run sudo in a container',
    'condition' => 'evt.type = execve and evt.dir=< and container.id != host and proc.name = sudo',
    'output'    => 'Sudo run in container (user=%user.name %container.info parent=%proc.pname cmdline=%proc.cmdline)',
    'priority'  => 'ERROR',
    'tags'      => ['users', 'container'],
  }],
}
```

##### Local rules, lists, and macro

```puppet
class { 'falco':
  local_rules => [
    {
      'rule'      => 'The program "sudo" is run in a container',
      'desc'      => 'An event will trigger every time you run sudo in a container',
      'condition' => 'evt.type = execve and evt.dir=< and container.id != host and proc.name = sudo',
      'output'    => 'Sudo run in container (user=%user.name %container.info parent=%proc.pname cmdline=%proc.cmdline)',
      'priority'  => 'ERROR',
      'tags'      => ['users', 'container'],
    },
    {
      'rule'      => 'rule 2',
      'desc'      => 'describing rule 2',
      'condition' => 'evt.type = execve and evt.dir=< and container.id != host and proc.name = sudo',
      'output'    => 'Sudo run in container (user=%user.name %container.info parent=%proc.pname cmdline=%proc.cmdline)',
      'priority'  => 'ERROR',
      'tags'      => ['users'],
    },
    {
      'list'  => 'shell_binaries',
      'items' => ['bash', 'csh', 'ksh', 'sh', 'tcsh', 'zsh', 'dash'],
    },
    {
      'list'  => 'userexec_binaries',
      'items' => ['sudo', 'su'],
    },
    {
      'list'  => 'known_binaries',
      'items' => ['shell_binaries', 'userexec_binaries'],
    },
    {
      'macro'     => 'safe_procs',
      'condition' => 'proc.name in (known_binaries)',
    }
  ],
}
```

#### Parameters

The following parameters are available in the `falco` class:

* [`rules_file`](#rules_file)
* [`local_rules`](#local_rules)
* [`json_output`](#json_output)
* [`json_include_output_property`](#json_include_output_property)
* [`log_stderr`](#log_stderr)
* [`log_syslog`](#log_syslog)
* [`log_level`](#log_level)
* [`priority`](#priority)
* [`buffered_outputs`](#buffered_outputs)
* [`outputs_rate`](#outputs_rate)
* [`outputs_max_burst`](#outputs_max_burst)
* [`syslog_output`](#syslog_output)
* [`file_output`](#file_output)
* [`stdout_output`](#stdout_output)
* [`webserver`](#webserver)
* [`program_output`](#program_output)
* [`http_output`](#http_output)
* [`package_ensure`](#package_ensure)
* [`service_ensure`](#service_ensure)
* [`service_enable`](#service_enable)
* [`service_restart`](#service_restart)

##### <a name="rules_file"></a>`rules_file`

Data type: `Array`

File(s) or Directories containing Falco rules, loaded at startup.
The name "rules_file" is only for backwards compatibility.
If the entry is a file, it will be read directly. If the entry is a directory,
every file in that directory will be read, in alphabetical order.

falco_rules.yaml ships with the falco package and is overridden with
every new software version. falco_rules.local.yaml is only created
if it doesn't exist. If you want to customize the set of rules, add
your customizations to falco_rules.local.yaml.

The files will be read in the order presented here, so make sure if
you have overrides they appear in later files.

Default value: `[
    '/etc/falco/falco_rules.yaml',
    '/etc/falco/falco_rules.local.yaml',
    '/etc/falco/k8s_audit_rules.yaml',
    '/etc/falco/rules.d',
  ]`

##### <a name="local_rules"></a>`local_rules`

Data type: `Array[Hash]`

An array of hashes of rules to be added to /etc/falco/falco_rules.local.yaml

Default value: `[]`

##### <a name="json_output"></a>`json_output`

Data type: `Boolean`

Whether to output events in json or text

Default value: ``false``

##### <a name="json_include_output_property"></a>`json_include_output_property`

Data type: `Boolean`

When using json output, whether or not to include the "output" property
itself (e.g. "File below a known binary directory opened for writing
(user=root ....") in the json output.

Default value: ``true``

##### <a name="log_stderr"></a>`log_stderr`

Data type: `Boolean`

Send information logs to stderr Note these are *not* security
notification logs! These are just Falco lifecycle (and possibly error) logs.

Default value: ``true``

##### <a name="log_syslog"></a>`log_syslog`

Data type: `Boolean`

Send information logs to stderr Note these are *not* security
notification logs! These are just Falco lifecycle (and possibly error) logs.

Default value: ``true``

##### <a name="log_level"></a>`log_level`

Data type: `Enum['alert', 'critical', 'error', 'warning', 'notice', 'info', 'debug']`

Minimum log level to include in logs. Note: these levels are
separate from the priority field of rules. This refers only to the
log level of falco's internal logging. Can be one of "emergency",
"alert", "critical", "error", "warning", "notice", "info", "debug".

Default value: `'info'`

##### <a name="priority"></a>`priority`

Data type: `Enum['emergency', 'alert', 'critical', 'error', 'warning', 'notice', 'informational', 'debug']`

Minimum rule priority level to load and run. All rules having a
priority more severe than this level will be loaded/run.  Can be one
of "emergency", "alert", "critical", "error", "warning", "notice",
"informational", "debug".

Default value: `'debug'`

##### <a name="buffered_outputs"></a>`buffered_outputs`

Data type: `Boolean`

Whether or not output to any of the output channels below is
buffered. Defaults to false

Default value: ``false``

##### <a name="outputs_rate"></a>`outputs_rate`

Data type: `Integer`

The number of tokens (i.e. right to send a notification) gained per second.

Default value: `1`

##### <a name="outputs_max_burst"></a>`outputs_max_burst`

Data type: `Integer`

The maximum number of tokens outstanding.

Default value: `1000`

##### <a name="syslog_output"></a>`syslog_output`

Data type: `Hash`

A hash to configure the syslog output.
See the template for available keys.

Default value: `{
    'enabled' => true,
  }`

##### <a name="file_output"></a>`file_output`

Data type: `Hash`

A hash to configure the file output.
See the template for available keys.

Default value: `{
    'enabled'    => false,
    'keep_alive' => false,
    'filename'   => '/var/log/falco-events.log',
  }`

##### <a name="stdout_output"></a>`stdout_output`

Data type: `Hash`

A hash to configure the stdout output.
See the template for available keys.

Default value: `{
    'enabled' => true,
  }`

##### <a name="webserver"></a>`webserver`

Data type: `Hash`

A has to configure the webserver.
See the template for available keys.

Default value: `{
    'enabled'              => false,
    'listen_port'          => 8765,
    'k8s_audit_endpoint'   => '/k8s-audit',
    'k8s_healthz_endpoint' => '/healthz',
    'ssl_enabled'          => false,
    'ssl_certificate'      => '/etc/falco/falco.pem',
  }`

##### <a name="program_output"></a>`program_output`

Data type: `Hash`

A hash to configure the program output.
See the template for available keys.

Default value: `{
    'enabled'    => false,
    'keep_alive' => false,
    'program'    => '"jq \'{text: .output}\' | curl -d @- -X POST https://hooks.slack.com/services/XXX"',
  }`

##### <a name="http_output"></a>`http_output`

Data type: `Hash`

A hash to configure the http output.
See the template for available keys.

Default value: `{
    'enabled'    => false,
    'url'        => 'http://some.url',
    'user_agent' => '"falcosecurity/falco"',
  }`

##### <a name="package_ensure"></a>`package_ensure`

Data type: `String[1]`

A string to be passed to the package resource's ensure parameter

Default value: `'installed'`

##### <a name="service_ensure"></a>`service_ensure`

Data type: `Variant[Boolean, Enum['running', 'stopped']]`

Desired state of the Falco service

Default value: `'running'`

##### <a name="service_enable"></a>`service_enable`

Data type: `Boolean`

Start the Falco service on boot?

Default value: ``true``

##### <a name="service_restart"></a>`service_restart`

Data type: `Boolean`

Does the service support restarting?

Default value: ``true``

### <a name="falcoconfig"></a>`falco::config`

Controls the contents of falco.yaml and sets up log rotate, if needed

### <a name="falcoinstall"></a>`falco::install`

Installs the falco package

### <a name="falcorepo"></a>`falco::repo`

Manages the repository falco is installed from

### <a name="falcoservice"></a>`falco::service`

Controls the state of the falco service

